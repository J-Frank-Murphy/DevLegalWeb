<!-- Flexible Post Display Template -->
<section class="posts-section">
    <div class="container">
        <!-- Optional section title -->
        {% if section_title == "Latest Insights" %}
            <h2>{{ section_title }}</h2>
        {% endif %}
        
        <!-- Post grid with aggressive styling to ensure consistent width -->
        <div class="blog-posts" style="display: grid !important; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)) !important; gap: 2rem !important; margin-bottom: 3rem !important;">
            {% if posts %}
                {% for post in posts %}
                <div class="blog-post" style="width: 100% !important; max-width: none !important;">
                    <div class="blog-post-thumbnail">
                        <img src="{{ url_for('static', filename=post.featured_image) if post.featured_image else url_for('static', filename='images/default-post.jpg') }}" alt="{{ post.title }}">
                    </div>
                    <div class="blog-post-content">
                        <div class="blog-post-meta">
                            <span class="blog-post-date">{{ post.created_at.strftime('%B %d, %Y') }}</span>
                            <span class="blog-post-category">{{ post.category.name }}</span>
                        </div>
                        <h3 class="blog-post-title">{{ post.title }}</h3>
                        <p class="blog-post-excerpt">{{ post.excerpt }}</p>
                        <a href="{{ url_for('blog.post', slug=post.slug) }}" class="read-more">Read More</a>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="no-posts-message">
                    <p>No posts found matching the criteria.</p>
                </div>
            {% endif %}
        </div>
        
        <!-- Aggressive CSS to override any conflicting styles -->
        <style>
            /* Target both homepage and blog page containers with high specificity */
            html body .container .blog-posts,
            html body .posts-section .container .blog-posts,
            html body .blog-posts,
            html body .posts-grid,
            html body .latest-posts .posts-grid,
            html body .container .posts-grid {
                display: grid !important;
                grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)) !important;
                gap: 2rem !important;
                margin-bottom: 3rem !important;
            }
            
            /* Ensure blog post cards take full width of their grid cell */
            html body .blog-post,
            html body .post-card {
                width: 100% !important;
                max-width: none !important;
                box-sizing: border-box !important;
            }
            
            /* Responsive adjustments with high specificity */
            @media (max-width: 768px) {
                html body .container .blog-posts,
                html body .posts-section .container .blog-posts,
                html body .blog-posts,
                html body .posts-grid,
                html body .latest-posts .posts-grid,
                html body .container .posts-grid {
                    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)) !important;
                }
            }
            
            @media (max-width: 480px) {
                html body .container .blog-posts,
                html body .posts-section .container .blog-posts,
                html body .blog-posts,
                html body .posts-grid,
                html body .latest-posts .posts-grid,
                html body .container .posts-grid {
                    grid-template-columns: 1fr !important;
                }
            }
        </style>
        
        <!-- Pagination controls -->
        {% if show_pagination and pagination %}
        <div class="pagination">
            {% if pagination.has_prev %}
                <a href="{{ url_for(request.endpoint, page=pagination.prev_num, **pagination_args) }}" class="pagination-prev">&laquo; Previous</a>
            {% else %}
                <span class="pagination-prev disabled">&laquo; Previous</span>
            {% endif %}
            
            {% for page_num in range(1, pagination.pages + 1) %}
                {% if page_num == pagination.page %}
                    <span class="pagination-current">{{ page_num }}</span>
                {% else %}
                    <a href="{{ url_for(request.endpoint, page=page_num, **pagination_args) }}" class="pagination-num">{{ page_num }}</a>
                {% endif %}
            {% endfor %}
            
            {% if pagination.has_next %}
                <a href="{{ url_for(request.endpoint, page=pagination.next_num, **pagination_args) }}" class="pagination-next">Next &raquo;</a>
            {% else %}
                <span class="pagination-next disabled">Next &raquo;</span>
            {% endif %}
        </div>
        {% endif %}
        
        <!-- Optional CTA button -->
        {% if show_view_all and view_all_url %}
        <div class="text-center">
            <a href="{{ view_all_url }}" class="cta-button">{{ view_all_text|default('View All Posts') }}</a>
        </div>
        {% endif %}
    </div>
</section>

<!-- JavaScript to ensure consistent widths after page load -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Force consistent grid layout after page load
    var blogPostsContainers = document.querySelectorAll('.blog-posts, .posts-grid');
    blogPostsContainers.forEach(function(container) {
        container.style.display = 'grid';
        container.style.gridTemplateColumns = 'repeat(auto-fill, minmax(350px, 1fr))';
        container.style.gap = '2rem';
        container.style.marginBottom = '3rem';
    });
    
    // Force blog post cards to take full width
    var blogPosts = document.querySelectorAll('.blog-post, .post-card');
    blogPosts.forEach(function(post) {
        post.style.width = '100%';
        post.style.maxWidth = 'none';
        post.style.boxSizing = 'border-box';
    });
});
</script>
